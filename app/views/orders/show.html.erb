<div id="order-form-inner">
  <div class="order-description">
    <%= markdown_parse @order.description %>
  </div>

  <ul class="order-category-list">
    <% @order.references_by_category.each do |k, v| %>
      <%= render 'category', category: k, references: v %>
    <% end %>
  </ul>

  <div class="options-section">
    <h3>Options</h3>
    <% unless @order.options.empty? %>
      <ul class="option-fields-list">
        <% @order.options.each do |opt| %>
          <li class="option-fields">
            <div class="option-fields-header">
              <i class="option-checkbox"></i>
              <h3>
                <%= opt.name %>
              </h3>
            </div>
            <div class="description markdown-description">
              <%= markdown_parse opt.description %>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      No options selected
    <% end %>
  </div>



  <% if policy(@order).confirm? %>
    <%= link_to confirm_listing_order_path(@listing, @order), 
      method: :post, 
      confirm: "Are you sure?",
      class: "order-confirm-button" do %>
        Confirm order
        <% unless @order.listing.quote_only? %>
          for $<%= price @order.calculated_final_price %>
        <% end %>
      <% end %>
    <% end %>

    <% if policy(@order).accept? %>
      <%= form_tag accept_listing_order_path(@listing, @order),
        method: :post, class: "order-confirm-form" do %>
          <% if @listing.quote_only? %>
            <%= react_component("QuotePicker") %>
          <% end %>
          <%= button_tag("Confirm Order") %>
        <% end %>
      <% end %>

      <% if policy(@order).purchase? %>
        <%= form_tag purchase_listing_order_path(@listing, @order),
          method: :post do %>
            <script
              src="https://checkout.stripe.com/checkout.js"
              class="stripe-button"
              data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
              data-amount="<%= @order.final_price %>"
              data-name="Commission from <%= escape_javascript(@listing.user.name) %>"
              data-image="<%= @listing.user.avatar(:tiny) %>"
            data-locale="auto"> </script>
        <% end %>
      <% end %>
    </div>
